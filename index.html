<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OzonPay BORABO</title>
    <style>
        body { font-family: Arial; background: #f9fbfe; padding: 30px; }
        h2 { color: #2c3e50; }
        label { display: block; margin-top: 10px; }
        input { width: 300px; padding: 8px; font-size: 14px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #2563eb; color: white; border: none; cursor: pointer; }
        .success { color: green; }
        .fail { color: red; }
    </style>
</head>
<body>
    <h2>Создание ссылки OzonPay</h2>
    <label>Номер заказа:</label>
    <input type="text" id="orderId" placeholder="Пример: 123456">

    <label>Сумма (₽):</label>
    <input type="number" id="amount" placeholder="Пример: 18000">

    <label>Email клиента:</label>
    <input type="email" id="email" placeholder="example@mail.ru">

    <label>Телефон клиента:</label>
    <input type="text" id="phone" placeholder="+7XXXXXXXXXX">

    <button onclick="sendData()">Сгенерировать ссылку</button>

    <label>Ссылка на оплату:</label>
    <input type="text" id="paymentLink" readonly>

    <label>Статус:</label>
    <input type="text" id="status" readonly>

    <script>
        let checkInterval;

        function sendData() {
            const orderId = document.getElementById("orderId").value;
            const amount = document.getElementById("amount").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;

            const payload = {
                orderId: orderId,
                amount: amount,
                email: email,
                phone: phone
            };

            fetch("https://script.google.com/macros/s/AKfycbz5ByPGaQ5bS_bocPj-HiXPn3U4KPkNVR55ZhCQVcumPg0mTclkgeCNRn3AZPXrsy3aBA/exec", {
                method: "POST",
                body: JSON.stringify(payload),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("paymentLink").value = data.link || "Ошибка";
                document.getElementById("status").value = "Ожидается оплата";
                document.getElementById("status").className = "";

                if (data.link) {
                    if (checkInterval) clearInterval(checkInterval);
                    checkInterval = setInterval(() => checkStatus(data.link), 15000);
                }
            })
            .catch(err => {
                document.getElementById("paymentLink").value = "Ошибка при запросе";
                document.getElementById("status").value = "";
            });
        }

        function checkStatus(link) {
            fetch("https://script.google.com/macros/s/AKfycbz5ByPGaQ5bS_bocPj-HiXPn3U4KPkNVR55ZhCQVcumPg0mTclkgeCNRn3AZPXrsy3aBA/exec?check=" + encodeURIComponent(link))
            .then(res => res.json())
            .then(data => {
                if (data.status) {
                    document.getElementById("status").value = data.status;
                    if (data.status.toLowerCase().includes("успешно")) {
                        document.getElementById("status").className = "success";
                        clearInterval(checkInterval);
                    } else if (data.status.toLowerCase().includes("ошибка")) {
                        document.getElementById("status").className = "fail";
                        clearInterval(checkInterval);
                    }
                }
            });
        }
    </script>
</body>
</html>